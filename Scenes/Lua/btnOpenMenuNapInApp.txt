LuaBehaviour = LuaBehaviour or {}

local XluaNetwork = CS.XluaNetwork();-- tạo instance của class XluaMethod để gọi các hàm không static

local XluaJSONNode = CS.XluaJSONNode();
local menu
function start()
   local btn = self.gameObject:GetComponent(typeof(CS.UnityEngine.UI.Button))
   -- `self.transform` là transform của GameObject hiện tại
   

   btn.onClick:AddListener(onClick)
end

function onClick()
   print('click triu hoi')
    menu = CS.AllMenu.ins.transform:Find("MenuNapinapp").gameObject
    menu.transform:Find("btnLichSu"):GetComponent("Button").onClick:AddListener(GetLichSuNap)
    --menu = CS.AllMenu.ins:GetCreateMenu("MenuNapinapp")
   local Onap = menu.transform:GetChild(0)
   for i = 0, Onap.transform.childCount - 1 do
    --CS.UnityEngine.Object.Destroy(Onap.transform:GetChild(i).gameObject:GetComponent(typeof(CS.UnityEngine.UI.Button)))
      --local btn = Onap.transform:GetChild(i).gameObject:AddComponent(typeof(CS.UnityEngine.UI.Button))
      local btn = Onap.transform:GetChild(i).gameObject:GetComponent(typeof(CS.UnityEngine.UI.Button))
      btn.onClick:AddListener(ClickMuaKimCuong)
   end
   menu:SetActive(true)
   --CS.AllMenu.ins:OpenMenuDisk('menutrieuhoi');
end

local function myCallback(response)
    CS.CrGame.ins.panelLoadDao:SetActive(false);
    print('Lua received callback dataaa: '.. response)
    local T = _G.LuaExtension:ParseTable(response)
    if T.status == "0" then
          local NapinApp = menu:GetComponent("NapinApp")
          NapinApp:MuaKimCuong()
          print('yeu cau ok')
     
    else
        CS.CrGame.ins:OnThongBaoNhanh(T.message, 2)
    end

end

function ClickMuaKimCuong()
    CS.CrGame.ins.panelLoadDao:SetActive(true);
    local btnchon = CS.UnityEngine.EventSystems.EventSystem.current.currentSelectedGameObject
    print('click mua kc'..btnchon.transform:GetSiblingIndex())

    local platform = (CS.UnityEngine.Application.platform == CS.UnityEngine.RuntimePlatform.Android) and "google" or "apple"

    local method = 'NapInApp'
    local nameClass = 'YeuCau'
    local keyData = { 'btnindex','platform'}
    local valueData = { tostring(btnchon.transform:GetSiblingIndex()),platform}

    XluaNetwork:SendRequest(method, nameClass, keyData, valueData, myCallback)
end

local function CallBackLichSuNap(response)
    print('Lua received callback dataaa: '.. response)
    local T = _G.LuaExtension:ParseTable(response)
    if T.status == "0" then
          
          print('CallBackLichSuNap ok')
     
    else
        CS.CrGame.ins:OnThongBaoNhanh(T.message, 2)
    end

end

function GetLichSuNap()
    local method = 'NapInApp'
    local nameClass = 'GetLichSu'
    local keyData = { '',}
    local valueData = {''}

    XluaNetwork:SendRequest(method, nameClass, keyData, valueData, CallBackLichSuNap)
end
